<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<style>
			*{ margin: 0;padding: 0;}
			.container{
				max-width:720px; 
				width: 100%; 
				margin-left: auto; 
				margin-right: auto;
				}
			/*.swiper,.slide,.slide img{
				width: 100%;
			}
			.swiper{ overflow: hidden;}
			.slide{ float: left;}
			.animate{ transition:all .3s cubic-bezier(0.500, 0.250, 0.160, 1.390);}*/
			.content{
				position: absolute;
				left:0;
				top:0;
				right:0;
				bottom:0;
				overflow: hidden;
			}
		</style>
	</head>
	<body>
		<div class="container">
			<div class="swiper"  on-change="sliderChange(event,this)" >

					<div class="slide"><img src="images/1.jpg" alt="" /></div>
					<div class="slide"><img src="images/2.jpg" alt="" /></div>
					<div class="slide"><img src="images/3.jpg" alt="" /></div>
					<div class="slide"><img src="images/4.jpg" alt="" /></div>
				<div class="slide">
					<h1>我是文本1</h1>
				</div>
				<div class="slide">
					<h1>我是文本2</h1>
				</div>
				<div class="slide">
					<h1>我是文本3</h1>
				</div>

			</div>
			<div class="content">
				<p>1 this is line p</p>
				<p>2 this is line p</p>
				<p>3 this is line p</p>
				<p>4 this is line p</p>
				<p>5 this is line p</p>
				<p>6 this is line p</p>
				<p>7 this is line p</p>
				<p>8 this is line p</p>
				<p>9 this is line p</p>
				<p>10 this is line p</p>
				<p>11 this is line p</p>
				<p>12 this is line p</p>
				<p>13 this is line p</p>
				<p>14 this is line p</p>
				<p>15 this is line p</p>
				<p>16 this is line p</p>
				<p>17 this is line p</p>
				<p>18 this is line p</p>
				<p>19 this is line p</p>
				<p>20 this is line p</p>
				<p>21 this is line p</p>
				<p>22 this is line p</p>
				<p>23 this is line p</p>
				<p>24 this is line p</p>
				<p>25 this is line p</p>
				<p>26 this is line p</p>
				<p>27 this is line p</p>
				<p>28 this is line p</p>
				<p>29 this is line p</p>
				<p>30 this is line p</p>
				<p>31 this is line p</p>
				<p>32 this is line p</p>
				<p>33 this is line p</p>
				<p>34 this is line p</p>
				<p>35 this is line p</p>
				<p>36 this is line p</p>
				<p>37 this is line p</p>
				<p>38 this is line p</p>
				<p>39 this is line p</p>
				<p>40 this is line p</p>
				<p>41 this is line p</p>
				<p>42 this is line p</p>
				<p>43 this is line p</p>
				<p>44 this is line p</p>
				<p>45 this is line p</p>
				<p>46 this is line p</p>
				<p>47 this is line p</p>
				<p>48 this is line p</p>
				<p>49 this is line p</p>
				<p>50 this is line p</p>
				<p>51 this is line p</p>
				<p>52 this is line p</p>
				<p>53 this is line p</p>
				<p>54 this is line p</p>
				<p>55 this is line p</p>
				<p>56 this is line p</p>
				<p>57 this is line p</p>
				<p>58 this is line p</p>
				<p>59 this is line p</p>
				<p>60 this is line p</p>
				<p>61 this is line p</p>
				<p>62 this is line p</p>
				<p>63 this is line p</p>
				<p>64 this is line p</p>
				<p>65 this is line p</p>
				<p>66 this is line p</p>
				<p>67 this is line p</p>
				<p>68 this is line p</p>
				<p>69 this is line p</p>
				<p>70 this is line p</p>
				<p>71 this is line p</p>
				<p>72 this is line p</p>
				<p>73 this is line p</p>
				<p>74 this is line p</p>
				<p>75 this is line p</p>
				<p>76 this is line p</p>
				<p>77 this is line p</p>
				<p>78 this is line p</p>
				<p>79 this is line p</p>
				<p>80 this is line p</p>
				<p>81 this is line p</p>
				<p>82 this is line p</p>
				<p>83 this is line p</p>
				<p>84 this is line p</p>
				<p>85 this is line p</p>
				<p>86 this is line p</p>
				<p>87 this is line p</p>
				<p>88 this is line p</p>
				<p>89 this is line p</p>
				<p>90 this is line p</p>
				<p>91 this is line p</p>
				<p>92 this is line p</p>
				<p>93 this is line p</p>
				<p>94 this is line p</p>
				<p>95 this is line p</p>
				<p>96 this is line p</p>
				<p>97 this is line p</p>
				<p>98 this is line p</p>
				<p>99 this is line p</p>
				<p>100 this is line p</p>
			</div>
		</div>
		<script>
			class Swiper{
				constructor(el,opt){
				    var DEFAULT={
				        loop:true,
						page:true,
						bounce:true,
						mode:"horizontal"
				    }

                    this.opt=Object.assign(DEFAULT,opt);
				   alert(this.opt.mode)

                    this.el=el;
					this.init();	//初始化


				}
				init(){
                    this.Event =new Event("on-change");

                    //1.把wraper 的宽算出来
                    //2.得到wraper
					if(!this.el.querySelector(".swiperWrap")){
                        var wraper =document.createElement("div");
                        wraper.className="swiperWrap";
                        wraper.innerHTML=this.el.innerHTML;
                        this.el.innerHTML="";
                        this.el.appendChild(wraper);
                        this.wraper=wraper;
					}


                    //3.拿到sliders
					if(this.opt.mode=="horizontal"){
						this.sliders =this.el.getElementsByClassName("slide");

						//4.拿到个数
						this.len = this.sliders.length;
                    //5. 拿到宽度
                    }
                    this.w = this.el.offsetWidth;

                    //6. 当前的幻灯片
                    this.index=1;
                    this.renderDom();//渲染页面
                    this.bindDom();//事件相关





				}
				// 绑定事件
				bindDom(){
					// 开始触摸
					this.wraper.addEventListener("touchstart",(e)=>{
						this.startHd(e,this);
					})
					this.wraper.addEventListener("mousedown",(e)=>{
						this.startHd(e,this);
					})
					// 触摸移动
					this.wraper.addEventListener("touchmove",(e)=>{
						this.moveHd(e,this);
					})


					// 触摸结束
					this.wraper.addEventListener("touchend",(e)=>{
						this.endHd(e,this);
					})
					this.wraper.addEventListener("mouseup",(e)=>{
						this.endHd(e,this);
					})
					//  当动画结束的时候移除 animateclass
					this.wraper.addEventListener("transitionend",()=>{
						// this.wraper.classList.remove("animate");
                        this.wraper.style.transition="";
					// 如果第5张结束了切换到第2张
						if(this.index==this.len-1){
							this.index=1;
							this.wraper.style.transform=`translate(${this.w*this.index*-1}px,0)`
						}else if(this.index==0){
							this.index=this.len-2;
							this.wraper.style.transform=`translate(${this.w*this.index*-1}px,0)`
						}


					})
					var that = this;
					window.onresize=function(){
						that.init();//从新加载所以

					}
				}
				// 改变dom与css
				renderDom(){
					// 给wrap 定义宽高
					if(!this.wraper.querySelector(".end")&&this.opt.loop&&this.opt.mode=='horizontal'){
						var end =this.sliders[this.len-1].cloneNode(true)
						end.classList.add("end");
						var first = this.sliders[0].cloneNode(true);
						first.classList.add("first");
						this.wraper.appendChild(first);
						this.wraper.insertBefore(end,this.sliders[0]);
						this.sliders =this.el.getElementsByClassName("slide");
						this.len =this.sliders.length;

					}

					//初始化

					this.el.style.width="100%";
                    alert(this.opt.mode)
					if(this.opt.mode=="vertical"){

                      this.el.style.height="100%";
                      this.wraper.style.width=this.el.offsetWidth+"px";
					}
                    this.el.style.overflow="hidden";


					if(this.opt.mode=="horizontal"){

                        this.wraper.style.width=this.w*this.len+"px";
                        this.wraper.style.height=this.el.offsetHeight+"px";
                        var imgs= this.wraper.querySelectorAll("img");

                        for(let i=0;i<this.len;i++){
                            this.sliders[i].style.width=this.w+"px";
                            this.sliders[i].style.float="left";
                            if(imgs[i]){
                                imgs[i].style.width="100%";
                            }

                        }
					}

					if(this.opt.loop){
                        this.goSlide(this.index);
					}


				}
				startHd(e,self) {
					self.sx = e.targetTouches ? e.targetTouches[0].clientX : e.clientX;
					// console.log(self.sx,"sx");
					self.oldTransform?"":self.oldTransform=0;
					console.log(self.dis);

					self.wraper.onmousemove=function(e){
						self.moveHd(e,self);
					}


				}
				moveHd(e,self){
							e.preventDefault();// 默认阻止拖动， 阻止默认事件

							if(e.targetTouches){
								self.mx=e.targetTouches[0].clientX
							}else{
								self.mx=e.clientX;
							}
                    // console.log(self.mx,"mx");
                    if(!self.opt.page){
                        var  dis =self.oldTransform+(self.mx-self.sx);

                    }else{

                        var  dis =self.mx-self.sx+self.w*self.index*-1;
                        console.log("page")
					}
                    if(!self.opt.bounce){
						if(dis>=0){dis=0;}
						if(dis<=self.w*self.len*-1+self.w){
							dis = self.w*self.len*-1+self.w;
						}

                    }
					self.dis=dis;

					self.wraper.style.transform=`translate(${dis}px,0)`
				}
				endHd(e,self){
					self.wraper.onmousemove=null;

					// 切换到对应的页面
					if(self.opt.page==false){
                        if(self.dis>=0&&self.opt.bounce){
                            self.wraper.style.transform=`translate(0px,0)`;
                            this.wraper.style.transition="all .3s cubic-bezier(0.500, 0.250, 0.160, 1.390)";
                            self.dis=0;
                        }
                        if(self.dis<self.w*self.len*-1+self.w&&self.opt.bounce){
                            self.wraper.style.transform=`translate(${self.w*self.len*-1+self.w}px,0)`;
                            this.wraper.style.transition="all .3s cubic-bezier(0.500, 0.250, 0.160, 1.390)";
                            self.dis=self.w*self.len*-1+self.w;
                        }

                        self.mx=0;
                        self.sx=0;
                        self.oldTransform=self.dis;
					}else{
                        self.wraper.removeEventListener("mousemove",(e)=>{
                            self.moveHd(e,self);
                    	})
//					console.log(self.sx-self.mx,self.w/5,"15");
                        // 向左滑动
                        if(self.sx-self.mx>self.w/5){
                            self.index++;
                            // 向右滑动
                        }else if(self.sx-self.mx<self.w/5*-1){
                            self.index--;


                        }

                        if(this.index>this.len-1){
                            this.index=1;

                        }else if(this.index<0){
                            this.index=this.len-2;

                        }

                        self.goSlide(self.index)
					}



				}
				// 切换页面并且清0
				goSlide(num){

					// this.wraper.classList.add("animate");
                    this.wraper.style.transition="all .3s cubic-bezier(0.500, 0.250, 0.160, 1.390)";
					this.wraper.style.transform=`translate(${this.w*num*-1}px,0)`
					this.sx=0;
					this.mx=0;

                    this.Event.num=num;
                    this.Event.name="change";
                    // 发送事件

                    this.el.dispatchEvent(this.Event);
					// console.log(this.el.onchange)



				}

			}
			var elem = document.getElementsByClassName("swiper")[0];
            // var elem = document.getElementsByClassName("content")[0];
            // new Swiper(elem,{mode:'vertical',loop:false,page:false});
            // new Swiper(elem,{page:false,loop:false,bounce:false});
            new Swiper(elem,{mode:"horizontal",loop:false,page:false});
            // new Swiper(elem,{});
            function sliderChange(e,elem){
                console.log(e,elem);
                console.log(`第${e.num}张幻灯片切换到了`);
            }
            function doClick(e){
                console.log(e.className);
			}
		</script>
	</body>
</html>
